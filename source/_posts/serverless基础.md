---
title: serverless基础
date: 2022-10-21 14:08:10
tags:
- serverless
categories:
- serverless
---

serverless 的基础内容

<!--more-->

## 概念

Serverless computing 无服务器运算，又称为函数即服务（Function as a service，即 FaaS）

我们不再需要关心服务（如 mysql、redis等）的申请机器、资源部署、资源碎片、弹性扩缩容问题，不再需要日夜值守关心各个依赖组件各项指标出现的问题，我们只需要聚焦在自己的上层业务逻辑上进行实现和优化，并且再也不会有闲置资源或者碎片资源问题 (按需使用)，这个就是 Serverless 想要构建的架构体系。

## 架构演进 

从整个演进过程来看，一直都在朝着资源切分粒度越来越细（**物理机 -> 操作系统 -> 进程 -> function**），资源利用率越来越高，运维工作越来越少，开发更聚焦业务方向。

物理机时代

虚拟化时代（重量级 VM），将物理机切分成一个个 VM 实例

云时代，云服务提供商，还是采用重量级 VM

虚拟化时代（轻量级容器 docker），devOps 开始火热，强制运维转开发，但是开发还是要关心运维

Serverless，去运维，开发人员只关注业务逻辑开发

## 如何影响微服务

serverless 是技术架构，微服务是业务架构，经济基础决定上层建筑，底层技术架构形式影响上层业务

以前的微服务以应用形式来组织，很多服务可能用到相同的功能，但是这些功能并没有达到可以分解为一个微服务的程度，此时，各个服务都会开发这一功能，从而导致代码重复。虽然可以使用共享库来解决，但是多语言环境下不一定行得通

而 serverless 架构中以 function 为最小粒度组织，业务分隔粒度可以无限小，任何一个模块功能甚至方法都可以独立存在，不需要通过共享库或者共享组件来复用。所以，在 Serverless 架构中，微服务组件的相互隔离和模块松耦合可以做的更好，应用甚至可以以独立函数的形式存在

## 和云原生的关系

serverless 就是为云而生的东西，天生具有云的基因(免运维弹性伸缩按量计费)

只需要聚焦业务逻辑不需要去关心和管理资源问题，是对容器技术的封装，代表了云原生的高级阶段

## serverless 要解决的问题

1. 机器资源分布不均

一个大型系统包括多种业务，通过拆分集群来进行业务隔离，不同集群由于不同的特性，会出现差距较大的资源利用率

2. 错峰问题

如果就为了一天 1 个小时的高峰流量来准备全天的机器，那剩下来的那 23 小时也是一种资源的浪费

3. 碎片化问题

微服务之间的数据交互主要是 RPC 和 MQ，常见的 RPC 框架本身就有比较完善的探活和负载均衡机制能够保证流量在不同机器的的均衡性，而 MQ 受限于顺序消费、失败重发、消息分区等特性没有办法很好的保证消费端负载均衡，比如我们常用的 RocketMQ 默认使用了一种分页的算法，即在客户端将消费者和分区分别按照字典序排好，再按照平均分配的原则每个消费者分 "一页" 的分区，所以这里就会引申出碎片的问题，当一个集群中消费的 Metaq 消息都是小分区的消息，所有的消息都会被流入集群中的前几个机器中，造成集群整体流量不均，带来集群资源碎片。

4. 资源问题

对于新接入的用户和业务，我们常见的做法是评估峰值业务量然后为其开启新集群预先分配一批机器，这里就有两个问题，一个是对于资源的预先评估是否能够准确而不造成浪费，另一个是成本结算方式，如果使用机器数来给用户或者业务方结算成本，对于有明显波峰波谷的使用者来说也是一种很大的成本资源浪费。

5. 运维问题

在每次大促或者压测之前都需要提前扩缩容准备资源、修改集群配置，随着各种大促小促和压测次数越来越密集，这种运维开销成本也变得越来越大。

---
## 参考

1. [Serverless 架构演进与实践](https://my.oschina.net/u/5783135/blog/5584238)